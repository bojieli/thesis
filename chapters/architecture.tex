\chapter{系统架构}

需要讨论以可编程网卡为中心的服务器软硬件架构。基本思想：可编程网卡是服务器与外界之间通信的“网关”，也是服务器内硬件设备、虚拟机间通信的“枢纽”，把 hypervisor 和 OS kernel 中需要高性能的数据平面卸载到可编程网卡。

1. 可编程网卡把主机内的硬件资源虚拟化成多个逻辑资源，实现外部机器和本地虚拟机的多路复用（一虚多，ClickNP网络虚拟化为例）。

2. 可编程网卡把数据中心内物理上分散的资源虚拟化成一个逻辑资源（多虚一，KV-Direct内存数据结构的客户端为例，还可以做 memory disaggregation）。

3. 绕过远程 CPU 直接访问远程硬件资源（KV-Direct内存数据结构的服务器端为例，还可以访问 SSD、GPU）。

4. OS kernel 给应用程序提供的抽象，可以重构为（控制面）协调和管理（仍在内核或用户态 daemon） + （数据面）用户态 library 负责高层抽象 + （数据面）可编程网卡负责多路复用、调度唤醒和可靠传输等低层语义（SocksDirect）。